<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frat House Barber Booking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
    <div id="app" class="p-6">
        <div class="max-w-4xl mx-auto">
            <!-- Loading State -->
            <div id="loading" class="text-center text-xl text-gray-600">Loading...</div>
            
            <!-- Main App -->
            <div id="mainApp" style="display: none;">
                <!-- Customer View -->
                <div id="customerView">
                    <div class="bg-white rounded-2xl shadow-xl p-8 mb-6">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center gap-3">
                                <svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.243 4.243 3 3 0 004.243-4.243zm0-5.758a3 3 0 10-4.243-4.243 3 3 0 004.243 4.243z"></path>
                                </svg>
                                <h1 class="text-3xl font-bold text-gray-800">Frat House Barber</h1>
                            </div>
                            <button onclick="showAdminLogin()" class="text-gray-400 hover:text-gray-600" title="Admin Login">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                </svg>
                            </button>
                        </div>
                        <p class="text-gray-600 mb-6">Book your haircut - $35 via Venmo</p>

                        <!-- Select Frat -->
                        <div class="mb-6">
                            <label class="flex items-center gap-2 text-sm font-semibold text-gray-700 mb-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                </svg>
                                Select Your Frat House
                            </label>
                            <select id="fratSelect" onchange="selectFrat(this.value)" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-indigo-500 focus:outline-none">
                                <option value="">Choose a frat house...</option>
                                <option value="Pi Kappa Phi">Pi Kappa Phi</option>
                                <option value="Lambda Chi Alpha">Lambda Chi Alpha</option>
                                <option value="Delta Sigma Phi">Delta Sigma Phi</option>
                                <option value="Alpha Epsilon Pi">Alpha Epsilon Pi</option>
                                <option value="Alpha Chi Rho">Alpha Chi Rho</option>
                                <option value="Sigma Phi Epsilon">Sigma Phi Epsilon</option>
                                <option value="Sigma Alpha Mu">Sigma Alpha Mu</option>
                                <option value="Tau Kappa Epsilon">Tau Kappa Epsilon</option>
                                <option value="Theta Chi">Theta Chi</option>
                                <option value="Alpha Pi Lambda">Alpha Pi Lambda</option>
                                <option value="Pi Lambda Phi">Pi Lambda Phi</option>
                            </select>
                        </div>

                        <!-- Select Day -->
                        <div id="daySelection" class="mb-6" style="display: none;">
                            <label class="flex items-center gap-2 text-sm font-semibold text-gray-700 mb-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                Select Day
                            </label>
                            <div class="grid grid-cols-2 gap-3">
                                <button onclick="selectDay('saturday')" id="saturdayBtn" class="p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 font-medium transition-all">
                                    Saturday<br>
                                    <span class="text-sm text-gray-500">11 AM - 7 PM</span>
                                </button>
                                <button onclick="selectDay('sunday')" id="sundayBtn" class="p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 font-medium transition-all">
                                    Sunday<br>
                                    <span class="text-sm text-gray-500">12 PM - 8 PM</span>
                                </button>
                            </div>
                        </div>

                        <!-- Select Date -->
                        <div id="dateSelection" class="mb-6" style="display: none;">
                            <label class="flex items-center gap-2 text-sm font-semibold text-gray-700 mb-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                <span id="dateLabel">Select Date</span>
                            </label>
                            <input type="date" id="dateInput" onchange="selectDate(this.value)" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-indigo-500 focus:outline-none">
                        </div>

                        <!-- Enter Info -->
                        <div id="infoSection" class="mb-6 space-y-4" style="display: none;">
                            <div>
                                <label class="text-sm font-semibold text-gray-700 mb-2 block">Your Name</label>
                                <input type="text" id="customerName" placeholder="John Doe" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-indigo-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="text-sm font-semibold text-gray-700 mb-2 block">Your Venmo Username</label>
                                <input type="text" id="venmoUsername" placeholder="@your-venmo" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-indigo-500 focus:outline-none">
                            </div>
                        </div>

                        <!-- Time Slots -->
                        <div id="timeSlots" style="display: none;">
                            <label class="flex items-center gap-2 text-sm font-semibold text-gray-700 mb-3">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                Available Time Slots (40 min each)
                            </label>
                            <div id="timeSlotButtons" class="grid grid-cols-3 gap-3"></div>
                        </div>

                        <!-- Confirmation -->
                        <div id="confirmation" class="mt-6 p-4 bg-green-50 border-2 border-green-500 rounded-lg" style="display: none;">
                            <div class="flex items-center gap-2 text-green-800 font-semibold mb-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                Slot Reserved!
                            </div>
                            <p class="text-green-700 text-sm mb-3">Your spot is reserved! Please send $35 to complete your booking:</p>
                            <div class="bg-white p-4 rounded border border-green-300">
                                <p class="font-mono text-indigo-600 font-bold text-lg mb-2">@felim-meade</p>
                                <p class="text-sm text-gray-600"><strong>Note:</strong> "<span id="confirmationNote"></span>"</p>
                                <a href="https://venmo.com/felim-meade" target="_blank" rel="noopener noreferrer" class="inline-block mt-3 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
                                    Open Venmo →
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin View -->
                <div id="adminView" style="display: none;">
                    <div class="bg-white rounded-2xl shadow-xl p-8">
                        <div class="flex justify-between items-center mb-6">
                            <div class="flex items-center gap-3">
                                <svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.243 4.243 3 3 0 004.243-4.243zm0-5.758a3 3 0 10-4.243-4.243 3 3 0 004.243 4.243z"></path>
                                </svg>
                                <div>
                                    <h1 class="text-3xl font-bold text-gray-800">Admin Dashboard</h1>
                                    <p class="text-gray-600">Manage all bookings</p>
                                </div>
                            </div>
                            <button onclick="exitAdmin()" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Exit Admin</button>
                        </div>

                        <div class="grid grid-cols-4 gap-4 mb-6">
                            <div class="bg-indigo-50 p-4 rounded-lg">
                                <p class="text-sm text-gray-600">Total Bookings</p>
                                <p id="totalBookings" class="text-2xl font-bold text-indigo-600">0</p>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <p class="text-sm text-gray-600">Paid</p>
                                <p id="paidBookings" class="text-2xl font-bold text-green-600">0</p>
                            </div>
                            <div class="bg-yellow-50 p-4 rounded-lg">
                                <p class="text-sm text-gray-600">Unpaid</p>
                                <p id="unpaidBookings" class="text-2xl font-bold text-yellow-600">0</p>
                            </div>
                            <div class="bg-purple-50 p-4 rounded-lg">
                                <p class="text-sm text-gray-600">Revenue</p>
                                <p id="totalRevenue" class="text-2xl font-bold text-purple-600">$0</p>
                            </div>
                        </div>

                        <div id="bookingsList" class="space-y-3"></div>
                    </div>
                </div>
            </div>

            <!-- Admin Login Modal -->
            <div id="adminModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" style="display: none;">
                <div class="bg-white rounded-xl p-6 max-w-md w-full">
                    <h2 class="text-xl font-bold mb-4">Admin Login</h2>
                    <div class="relative">
                        <input type="password" id="adminPassword" placeholder="Enter password" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-indigo-500 focus:outline-none pr-10" onkeypress="if(event.key === 'Enter') adminLogin()">
                    </div>
                    <div class="flex gap-3 mt-4">
                        <button onclick="adminLogin()" class="flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">Login</button>
                        <button onclick="closeAdminModal()" class="flex-1 px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const ADMIN_PASSWORD = 'barber2024';
        const STORAGE_KEY = 'barber-bookings';
        
        const saturdaySlots = ['11:00 AM', '11:40 AM', '12:20 PM', '1:00 PM', '1:40 PM', '2:20 PM', '3:00 PM', '3:40 PM', '4:20 PM', '5:00 PM', '5:40 PM', '6:20 PM'];
        const sundaySlots = ['12:00 PM', '12:40 PM', '1:20 PM', '2:00 PM', '2:40 PM', '3:20 PM', '4:00 PM', '4:40 PM', '5:20 PM', '6:00 PM', '6:40 PM', '7:20 PM'];
        
        let bookings = {};
        let selectedFrat = '';
        let selectedDay = '';
        let selectedDate = '';
        let isAdmin = false;

        // Initialize
        async function init() {
            await loadBookings();
            document.getElementById('loading').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
        }

        async function loadBookings() {
            try {
                const result = await window.storage.get(STORAGE_KEY, true);
                if (result && result.value) {
                    bookings = JSON.parse(result.value);
                }
            } catch (error) {
                console.log('No existing bookings found');
            }
        }

        async function saveBookings() {
            try {
                await window.storage.set(STORAGE_KEY, JSON.stringify(bookings), true);
            } catch (error) {
                console.error('Error saving bookings:', error);
                alert('Error saving booking. Please try again.');
            }
        }

        function selectFrat(frat) {
            selectedFrat = frat;
            selectedDay = '';
            selectedDate = '';
            
            if (frat) {
                document.getElementById('daySelection').style.display = 'block';
                document.getElementById('dateSelection').style.display = 'none';
                document.getElementById('infoSection').style.display = 'none';
                document.getElementById('timeSlots').style.display = 'none';
            } else {
                document.getElementById('daySelection').style.display = 'none';
            }
        }

        function selectDay(day) {
            selectedDay = day;
            selectedDate = '';
            
            document.getElementById('saturdayBtn').className = day === 'saturday' 
                ? 'p-4 rounded-lg border-2 border-indigo-600 bg-indigo-50 text-indigo-700 font-medium transition-all'
                : 'p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 font-medium transition-all';
            
            document.getElementById('sundayBtn').className = day === 'sunday' 
                ? 'p-4 rounded-lg border-2 border-indigo-600 bg-indigo-50 text-indigo-700 font-medium transition-all'
                : 'p-4 rounded-lg border-2 border-gray-200 hover:border-indigo-300 font-medium transition-all';
            
            document.getElementById('dateLabel').textContent = `Select ${day === 'saturday' ? 'Saturday' : 'Sunday'}`;
            document.getElementById('dateInput').value = '';
            document.getElementById('dateSelection').style.display = 'block';
            document.getElementById('infoSection').style.display = 'none';
            document.getElementById('timeSlots').style.display = 'none';
        }

        function selectDate(date) {
            const dateObj = new Date(date + 'T12:00:00');
            const dayOfWeek = dateObj.getDay();
            const expectedDay = selectedDay === 'saturday' ? 6 : 0;
            
            if (dayOfWeek !== expectedDay) {
                alert(`Please select a ${selectedDay === 'saturday' ? 'Saturday' : 'Sunday'}`);
                document.getElementById('dateInput').value = '';
                return;
            }
            
            selectedDate = date;
            document.getElementById('infoSection').style.display = 'block';
            document.getElementById('timeSlots').style.display = 'block';
            renderTimeSlots();
        }

        function renderTimeSlots() {
            const slots = selectedDay === 'saturday' ? saturdaySlots : sundaySlots;
            const container = document.getElementById('timeSlotButtons');
            container.innerHTML = '';
            
            slots.forEach(time => {
                const key = `${selectedFrat}-${selectedDate}-${time}`;
                const booked = bookings[key] !== undefined;
                
                const button = document.createElement('button');
                button.className = booked 
                    ? 'p-3 rounded-lg font-medium bg-gray-200 text-gray-500 cursor-not-allowed'
                    : 'p-3 rounded-lg font-medium bg-indigo-600 text-white hover:bg-indigo-700';
                button.innerHTML = time + (booked ? '<div class="text-xs mt-1">Booked</div>' : '');
                button.disabled = booked;
                
                if (!booked) {
                    button.onclick = () => bookSlot(time);
                }
                
                container.appendChild(button);
            });
        }

        async function bookSlot(time) {
            const name = document.getElementById('customerName').value.trim();
            const venmo = document.getElementById('venmoUsername').value.trim();
            
            if (!name) {
                alert('Please enter your name');
                return;
            }
            if (!venmo) {
                alert('Please enter your Venmo username');
                return;
            }
            
            const key = `${selectedFrat}-${selectedDate}-${time}`;
            bookings[key] = {
                name: name,
                venmo: venmo,
                time: time,
                frat: selectedFrat,
                date: selectedDate,
                day: selectedDay,
                paid: false,
                bookedAt: new Date().toISOString()
            };
            
            await saveBookings();
            
            document.getElementById('confirmationNote').textContent = `${selectedFrat} - ${name}`;
            document.getElementById('confirmation').style.display = 'block';
            document.getElementById('customerName').value = '';
            document.getElementById('venmoUsername').value = '';
            
            renderTimeSlots();
        }

        function showAdminLogin() {
            document.getElementById('adminModal').style.display = 'flex';
            setTimeout(() => document.getElementById('adminPassword').focus(), 100);
        }

        function closeAdminModal() {
            document.getElementById('adminModal').style.display = 'none';
            document.getElementById('adminPassword').value = '';
        }

        function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                isAdmin = true;
                closeAdminModal();
                showAdminView();
            } else {
                alert('Incorrect password');
                document.getElementById('adminPassword').value = '';
            }
        }

        function showAdminView() {
            document.getElementById('customerView').style.display = 'none';
            document.getElementById('adminView').style.display = 'block';
            renderAdminView();
        }

        function exitAdmin() {
            isAdmin = false;
            document.getElementById('customerView').style.display = 'block';
            document.getElementById('adminView').style.display = 'none';
        }

        function renderAdminView() {
            const bookingArray = Object.entries(bookings).sort((a, b) => {
                const dateA = new Date(a[1].date + ' ' + a[1].time);
                const dateB = new Date(b[1].date + ' ' + b[1].time);
                return dateA - dateB;
            });
            
            const total = bookingArray.length;
            const paid = bookingArray.filter(([_, b]) => b.paid).length;
            const unpaid = total - paid;
            
            document.getElementById('totalBookings').textContent = total;
            document.getElementById('paidBookings').textContent = paid;
            document.getElementById('unpaidBookings').textContent = unpaid;
            document.getElementById('totalRevenue').textContent = '$' + (paid * 35);
            
            const container = document.getElementById('bookingsList');
            container.innerHTML = '';
            
            if (bookingArray.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500 py-8">No bookings yet</p>';
                return;
            }
            
            bookingArray.forEach(([key, booking]) => {
                const div = document.createElement('div');
                div.className = `p-4 border-2 rounded-lg ${booking.paid ? 'border-green-300 bg-green-50' : 'border-gray-200'}`;
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-2">
                                <p class="font-bold text-lg text-gray-800">${booking.name}</p>
                                <span class="px-2 py-1 rounded text-xs font-semibold ${booking.paid ? 'bg-green-500 text-white' : 'bg-yellow-500 text-white'}">
                                    ${booking.paid ? 'PAID' : 'UNPAID'}
                                </span>
                            </div>
                            <div class="grid grid-cols-2 gap-2 text-sm">
                                <p class="text-gray-600"><strong>Frat:</strong> ${booking.frat}</p>
                                <p class="text-gray-600"><strong>Date:</strong> ${booking.date}</p>
                                <p class="text-gray-600"><strong>Time:</strong> ${booking.time}</p>
                                <p class="text-indigo-600"><strong>Venmo:</strong> @${booking.venmo}</p>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="togglePaid('${key}')" class="px-4 py-2 rounded-lg font-medium transition-all ${booking.paid ? 'bg-green-500 text-white hover:bg-green-600' : 'bg-gray-300 text-gray-700 hover:bg-gray-400'}">
                                ${booking.paid ? '✓ Paid' : 'Mark Paid'}
                            </button>
                            <button onclick="deleteBooking('${key}')" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">
                                Delete
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        async function togglePaid(key) {
            bookings[key].paid = !bookings[key].paid;
            await saveBookings();
            renderAdminView();
        }

        async function deleteBooking(key) {
            if (confirm('Are you sure you want to delete this booking?')) {
                delete bookings[key];
                await saveBookings();
                renderAdminView();
            }
        }

        // Start the app
        init();
    </script>
</body>
</html>